<canvas id="cnv" width=400 height=400></canvas>
<script>

mrg = 20;
width = document.getElementById("cnv").width-(2*mrg);
height = document.getElementById("cnv").height-(2*mrg);
anchoCelda = width/9;
altoCelda = height/9
cuenta = {};
cont = 1;
curX = 0;
curY = 0;
TECLA_ESPACIO = 32;
FLECHA_IZQ = 37;
FLECHA_ARRIBA = 38;
FLECHA_DER = 39;
FLECHA_ABAJO = 40;
NUM_1 = 49;
NUM_2 = 50;
NUM_3 = 51;
NUM_4 = 52;
NUM_5 = 53;
NUM_6 = 54;
NUM_7 = 55;
NUM_8 = 56;
NUM_9 = 57;
MAX_AUTOG = 20;

window.onload = function()
{
    canv = document.getElementById("cnv")
    ctx = canv.getContext("2d")
    dibujarTablero();
    game();
    document.addEventListener("keydown",keyPush);
    setInterval(game,1000/300)
}

function keyPush(evt)
{
    switch(evt.keyCode)
    {
        case TECLA_ESPACIO:
            if(cont == 0)
            cont = 1;
            else
            cont = 0;
            break;
        case FLECHA_IZQ:
            cambiaCoordenadaCursor(-1,0);
            break;
        case FLECHA_ARRIBA:
            cambiaCoordenadaCursor(0,-1);
            break;
        case FLECHA_ABAJO:
            cambiaCoordenadaCursor(0,1);
            break;
        case FLECHA_DER:
            cambiaCoordenadaCursor(1,0);
            break;
        case NUM_1:
            asignaValorCasillaActual(1); 
            break;
        case NUM_2: 
            asignaValorCasillaActual(2);
            break;
        case NUM_3: 
            asignaValorCasillaActual(3);
            break;
        case NUM_4: 
            asignaValorCasillaActual(4);
            break;
        case NUM_5: 
            asignaValorCasillaActual(5);
            break;
        case NUM_6: 
            asignaValorCasillaActual(6);
            break;
        case NUM_7: 
            asignaValorCasillaActual(7);
            break;
        case NUM_8: 
            asignaValorCasillaActual(8);
            break;
        case NUM_9: 
            asignaValorCasillaActual(9);
            break;
    }
}

function asignaValorCasillaActual(valor)
{
    tipoValor = 0;
    key = curX+','+curY;
    if(validarValorEnColumna(valor))
        cuenta[key] = valor+','+tipoValor
    else
        alert('no se puede!');
}

function cambiaCoordenadaCursor(x,y)
{
    if(x!=0)
    {
        if(x>0 && curX<(9-x))
            curX+=x;
        if(x<0 && curX>(1+x))
            curX+=x;
    }
    if(y!=0)
    {
        if(y>0 && curY<(9-y))
            curY+=y;
        if(y<0 && curY>(1+y))
            curY+=y;
    }
}

function dibujarTablero()
{
    ctx.fillStyle="lightblue";
    ctx.fillRect(0,0,canv.width,canv.height);
}
  
function dibujarCursor()
{
    ctx.fillStyle="purple";
    ctx.fillRect(mrg+(curX*anchoCelda),mrg+(curY*altoCelda),anchoCelda,altoCelda)
}

function game()
{
    if(cont == 1)
    {   
        dibujarTablero();
        dibujarCursor();
        pintaGrilla();
        agregarNumeroAleatorio();
        pintaContadores();
    }
}

function pintaGrilla()
{
    ctx.strokeRect(mrg,mrg,width,height);
    for(i=1;i<10;i++)
    {
        for(j=1;j<10;j++)
        {   
            ctx.lineWidth = 1;
            ctx.strokeStyle="black";
            ctx.strokeRect(mrg+(anchoCelda*(i-1)),mrg+(altoCelda*(j-1)),anchoCelda,altoCelda);
            if((i%3==1) && (j%3 == 1) && (i<10) && (j<10))
            {
                ctx.strokeStyle="black";
                ctx.lineWidth = 3;
                ctx.strokeRect(mrg+(anchoCelda*(i-1)),mrg+(altoCelda*(j-1)),anchoCelda*3,altoCelda*3);
            }
        }
    }
}

function pintaContadores()
{
    ctx.fillStyle="red"
    var v = Object.keys(cuenta)
    for(i=0;i<v.length;i++)
    {
        var llave = v[i];
        var coord = llave.split(',');
        var cX = coord[0];
        var cY = coord[1];
        cX = mrg+(anchoCelda*cX)+(anchoCelda/2)-5
        cY = mrg+(altoCelda*cY)+(altoCelda/2)+5
        var dato = cuenta[llave].split(',')[0];
        var tipoDato = cuenta[llave].split(',')[1];
        if(tipoDato == 1)
            ctx.font = "12px Arial";
        else
            ctx.font = "15px Arial";
        ctx.fillText(dato,cX,cY);
    }
}

function validarValorEnCruz(valor,x,y)
{
    if(validarValorEnColumna(valor,x) && validarValorEnFila(valor,y))
        return true;
    else
        return false;
}

function validarValorEnCruz(valor)
{
    if(validarValorEnColumna(valor) && validarValorEnFila(valor))
        return true;
    else
        return false;
}

function validarValorEnFila(valor)
{
    var key = 0;
    for(i=0;i<9;i++)
    {
        key = curX+','+i;
        if(cuenta[key] == valor)
            return false;
    }
}

function validarValorEnFila(valor,x)
{
    var key = 0;
    for(i=0;i<9;i++)
    {
        key = x+','+i;
        if(cuenta[key] == valor)
            return false;
    }
}

function validarValorEnColumna(valor)
{
    var key = 0;
    for(i=0;i<9;i++)
    {
        key = i+','+curY;
        if(cuenta[key] == valor)
            return false;
    }
}

function validarValorEnColumna(valor,y)
{
    var key = 0;
    for(i=0;i<9;i++)
    {
        key = i+','+y;
        if(cuenta[key] == valor)
            return false;
    }
}

function agregarNumeroAleatorio()
{
    var elementos = Object.keys(cuenta)
    if(elementos.length >= MAX_AUTOG)
        return;
     tipoValor = 1 
    // valor = generarValorCelda(9,1);
    cX = generarCoordenadaCelda();
    cY = generarCoordenadaCelda();
    
    var numsDisp = valoresDisponiblesCelda(cX,cY);
    var largoNumDisp = numsDisp.length;
     var indice = generarValorCelda(0,largoNumDisp-1);
    valor = numsDisp[indice];
    key = cX+','+cY;
        if(cuenta[key] == undefined)
            cuenta[key] = valor+','+tipoValor
}

function generarCoordenadaCelda()
{
    do
    {
        ale = Math.floor(Math.random()*10);
    }
    while(ale>=9)
    return ale;
}

function generarValorCelda(min,max)
{
    ale = 0;
    while(ale>max || ale<min)
    {
        ale = Math.floor(Math.random()*10);
    }
    return ale;
}

function valoresDisponiblesCelda()
{
    var key = 0;
    var nums = [1,2,3,4,5,6,7,8,9]
    for(i=0;i<9;i++)
    {
        keyH = curX+','+i;
        if(cuenta[keyH] != undefined)
        {
            var valor = cuenta[keyH];
            valor = valor.split(',')[0];
            nums.splice(nums.indexOf(parseInt(valor)),1)
        }

        keyV = i+','+curY;
        if(cuenta[keyV] != undefined)
        {
            var valor = cuenta[keyV];
            valor = valor.split(',')[0];
            nums.splice(nums.indexOf(parseInt(valor)),1)
        }
    }
    console.log(nums);
    return nums;
}

function valoresDisponiblesCelda(cX,cY)
{
    var key = 0;
    var nums = [1,2,3,4,5,6,7,8,9]
    for(i=0;i<9;i++)
    {
        keyH = this.cX+','+i;
        if(cuenta[keyH] != undefined)
        {
            var valor = cuenta[keyH];
            valor = valor.split(',')[0];
            nums.splice(nums.indexOf(parseInt(valor)),1)
        }

        keyV = i+','+this.cY;
        if(cuenta[keyV] != undefined)
        {
            var valor = cuenta[keyV];
            valor = valor.split(',')[0];
            nums.splice(nums.indexOf(parseInt(valor)),1)
        }
    }
    console.log(nums);
    return nums;
}
</script>